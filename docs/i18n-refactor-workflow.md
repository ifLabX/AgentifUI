# AgentifUI i18n重构工作流程 Prompt

## 任务定义

你需要对AgentifUI项目进行国际化重构，将硬编码的中文文本转换为多语言支持。这是一个严格的渐进式重构任务。

## 核心约束

1. **功能保护原则**：绝对不能修改任何组件的逻辑、样式、状态管理或业务功能
2. **渐进式重构原则**：必须按照"中文翻译设计→组件重构→其他语言翻译"的顺序进行
3. **严格审核原则**：每个阶段完成后必须通过所有验证检查才能进入下一阶段

## 重构工作流程

### 阶段1：分析和准备

首先搜索目标组件中的所有硬编码中文文本，然后学习项目中现有的翻译文件结构，找到相似模块作为参考，理解翻译键的命名规范和组织层次。

### 阶段2：中文翻译结构设计

在messages/zh-CN.json中设计并添加新的翻译结构。必须使用层次化的键名结构，具体阅读一下文件的结构。设计时要考虑翻译的分组逻辑，将相关的文本归类到合适的子对象中。完成后必须验证JSON格式的正确性。

### 阶段3：组件代码重构

在目标组件中添加useTranslations导入，然后创建对应的翻译hook实例。逐个将硬编码的中文文本替换为翻译函数调用。处理特殊情况如条件渲染、参数化翻译、动态文本组合等。确保所有用户可见的文本都已国际化。

### 阶段4：其他语言翻译

按照固定顺序添加其他语言的翻译：必须保持所有语言文件的结构完全一致，只翻译值而不改变键名。翻译质量要求准确、符合UI习惯。

### 阶段5：全面审核验证

进行多维度的质量检查：检查所有翻译文件的行数是否一致；验证关键翻译键在所有语言中都存在；确认目标组件中不再有硬编码中文文本；进行TypeScript类型检查确保没有错误；验证所有JSON文件格式正确。

## 详细审核标准

### 翻译文件一致性检查

所有语言的翻译文件必须具有完全相同的行数和结构。每个翻译键都必须在所有语言文件中存在。文件格式必须是有效的JSON。

### 硬编码移除验证

目标组件中不应再包含任何硬编码的中文文本字符串。注释中的中文可以保留。所有用户界面文本都应该通过翻译函数获取。

### 代码质量验证

TypeScript编译检查必须通过，不能有任何类型错误。组件的导入语句要正确添加useTranslations。翻译hook的路径要准确对应翻译文件中的结构。

### 功能完整性验证

重构后的组件功能必须与原来完全一致。用户界面的显示效果不能有任何改变。所有交互行为保持不变。

## 质量检查清单

### 开发阶段必检项

确认翻译结构设计合理且参考了现有模式；中文翻译已正确添加到zh-CN.json；JSON格式验证通过；组件正确导入了useTranslations；所有硬编码文本已替换为翻译调用；参数化翻译处理正确。

### 翻译阶段必检项

除了中文的其他语言翻译按顺序完成；所有语言文件结构完全一致；翻译内容准确且符合UI规范；没有遗漏任何翻译项。

### 最终验证必检项

所有翻译文件行数完全一致；关键翻译键在各语言中都存在；目标组件无任何中文硬编码；TypeScript类型检查完全通过；JSON格式全部正确；功能测试通过。

## 特殊情况处理指南

### 参数化翻译处理

当文本中包含动态内容时，使用参数化翻译。在翻译文件中使用占位符，在组件中传递参数对象。

### 条件渲染文本处理

对于根据状态显示不同文本的情况，为每种状态创建对应的翻译键，在组件中使用条件表达式选择合适的翻译。

### 复杂文本组合处理

避免在组件中拼接翻译文本。如果必须组合，优先考虑参数化翻译或重新设计翻译结构。

## 优化验证流程

### 验证工具

项目提供了两个验证工具来确保重构质量：

1. **`scripts/validate-i18n-consistency.py`** - 完整的一致性验证脚本
   - 检查所有翻译文件行数一致性
   - 验证JSON格式正确性
   - 验证结构键完全一致
   - 提供详细的差异报告

2. **`scripts/i18n-refactor-helper.py`** - 重构助手工具
   - 自动备份和恢复功能
   - 快速检查功能
   - 集成验证功能
   - 增量验证支持

### 优化的工作流程

建议按照以下5个阶段进行重构，每个阶段都有自动化验证：

**阶段0：准备和备份**

```bash
python scripts/i18n-refactor-helper.py backup
```

**阶段1-4：按原有流程进行重构**

- 每完成一个阶段后运行验证

```bash
python scripts/validate-i18n-consistency.py
```

**阶段5：最终验证和清理**

```bash
# 验证并自动清理备份
python scripts/i18n-refactor-helper.py check

# 或者分步执行
python scripts/validate-i18n-consistency.py
python scripts/i18n-refactor-helper.py cleanup
```

### 安全保障

- 每次重构前自动备份
- 出现问题时可快速恢复
- 增量验证及时发现问题
- 验证通过后自动清理备份文件
- 严格的重构原则确保代码质量

## 重构成功标准

重构完成后，项目应该支持四种语言的完整显示，所有硬编码中文文本被移除，组件功能完全不受影响，代码通过所有质量检查，翻译文件结构规范且一致。
